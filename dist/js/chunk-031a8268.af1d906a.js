(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-031a8268"],{"4f70":function(e,t,l){},ceb9:function(e,t,l){"use strict";var a=l("4f70"),o=l.n(a);o.a},eb4f:function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("g-page",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[l("g-form",{ref:"form",attrs:{rules:e.rules,row:e.row,model:e.form}}),l("div",{staticClass:"base_info"},[l("div",{staticClass:"divider-title"},[e._v(" 基本属性 "),l("g-button",{staticStyle:{float:"right"},attrs:{text:"新增"},on:{click:e.addNewProperty}})],1),l("el-table",{attrs:{data:e.basicProperties}},[l("el-table-column",{attrs:{label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-input",{model:{value:t.row.stName,callback:function(l){e.$set(t.row,"stName",l)},expression:"scope.row.stName"}})]}}])}),l("el-table-column",{attrs:{label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-select",{model:{value:t.row.stType,callback:function(l){e.$set(t.row,"stType",l)},expression:"scope.row.stType"}},e._l(e.typeOption,(function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),l("el-table-column",{attrs:{label:"列名"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-input",{model:{value:t.row.stColumnName,callback:function(l){e.$set(t.row,"stColumnName",l)},expression:"scope.row.stColumnName"}})]}}])}),l("el-table-column",{attrs:{label:"长度"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-input",{model:{value:t.row.stlength,callback:function(l){e.$set(t.row,"stlength",l)},expression:"scope.row.stlength"}})]}}])}),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text",size:"small"},on:{click:function(l){return e.deletePropertyData(t)}}},[e._v("删除")])]}}])})],1)],1),l("div",{staticClass:"base_info"},[l("div",{staticClass:"divider-title"},[e._v(" 关系属性 "),l("g-button",{staticStyle:{float:"right"},attrs:{text:"新增"},on:{click:e.addNewRef}})],1),l("el-table",{attrs:{data:e.refs}},[l("el-table-column",{attrs:{label:"关联类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-select",{attrs:{disabled:"0"===t.row.inRelation},model:{value:t.row.inRelation,callback:function(l){e.$set(t.row,"inRelation",l)},expression:"scope.row.inRelation"}},e._l(e.refTypeOption,(function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),l("el-table-column",{attrs:{label:"关联模型名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-autocomplete",{attrs:{disabled:"0"===t.row.inRelation,"fetch-suggestions":e.querySearchAsync},on:{select:function(l){return e.refTypeModelName(t)}},model:{value:t.row.modelName,callback:function(l){e.$set(t.row,"modelName",l)},expression:"scope.row.modelName"}})]}}])}),l("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{disabled:"0"===t.row.inRelation,type:"text",size:"small"},on:{click:function(l){return e.deleteRefData(t)}}},[e._v("删除")])]}}])})],1)],1),l("div",{staticClass:"divider-title",attrs:{flex:"dir:right"}},[l("g-button",{attrs:{text:"保存",type:"primary"},on:{click:function(t){return e.saveModel()}}})],1)],1)},o=[],s=(l("4de4"),l("c975"),l("d81d"),l("d3b7"),l("3ca3"),l("ddb0"),l("d4ec")),n=l("bee2"),i=l("262e"),r=l("2caf"),u=l("9ab4"),c=l("60a3"),d=l("2ef0"),f=l.n(d),m=function(e){Object(i["a"])(l,e);var t=Object(r["a"])(l);function l(){var e;return Object(s["a"])(this,l),e=t.apply(this,arguments),e.basicProperties=[],e.refs=[],e.loading=!0,e.needDelRels=[],e.needDelPros=[],e.refTypeOption=[{label:"一对多",value:"1"},{label:"多对一",value:"0"}],e.form={stName:"",stTableName:"",des:""},e.typeOption=[{label:"String",value:"varchar"},{label:"Integer",value:"Integer"},{label:"Boolean",value:"Boolean"},{label:"Date",value:"Date"},{label:"text",value:"text"},{label:"Double",value:"Double"}],e}return Object(n["a"])(l,[{key:"pageLoad",value:function(){return!0}},{key:"querySearchAsync",value:function(e,t){var l=f.a.cloneDeep(this.models);e&&(l=this.models.filter((function(t){return t.label.indexOf(e)>-1}))),l.map((function(e){e.value=e.label})),t(l)}},{key:"saveModel",value:function(){var e=this;this.$api("saveModel",{data:{id:this.id,stName:this.form.stName,stTableName:this.form.stTableName,rels:this.refs,bases:this.basicProperties,needDelRels:this.needDelRels,needDelPros:this.needDelPros}}).then((function(){e.pageLoad()}))}},{key:"loadData",value:function(){var e=this;Promise.all([this.getModel(),this.getModelBase(),this.getModelRel()]).then((function(){e.loading=!1}))}},{key:"refTypeModelName",value:function(e){e.row.stDestModelID=this.models.filter((function(t){return t.label===e.row.modelName}))[0].id,e.row.stName=this.models.filter((function(t){return t.label===e.row.modelName}))[0].stTableName,e.row.stDestName=this.form.stTableName}},{key:"clearData",value:function(){this.basicProperties.length=0,this.refs.length=0,this.loading=!1,this.form={stName:"",stTableName:"",des:""}}},{key:"getModel",value:function(){var e=this;this.$api("getModel",{where:[{and:[{modelId:this.id}]}]}).then((function(t){e.form=t.result.list[0]}))}},{key:"getModelBase",value:function(){var e=this;this.$api("getModelBase",{where:[{and:[{modelId:this.id}]}]}).then((function(t){e.basicProperties=t&&t.result&&t.result.list}))}},{key:"getModelRel",value:function(){var e=this;this.$api("getModelRel",{where:[{and:[{modelId:this.id}]}]}).then((function(t){var l=t&&t.result&&t.result.list;l.map((function(t){t.modelName=e.getModelName(t),t.inRelation=String(t.inRelation)})),e.refs=l}))}},{key:"getModelName",value:function(e){return this.models.filter((function(t){return t.id===e.stDestModelID}))[0].stName}},{key:"addNewProperty",value:function(){this.basicProperties.push({stName:"",stType:"varchar",stColumnName:"",stlength:"32"})}},{key:"deletePropertyData",value:function(e){e.row.id&&this.needDelPros.push(e.row.id),this.basicProperties=f.a.remove(this.basicProperties,(function(t,l){return l!==e.$index}))}},{key:"deleteRefData",value:function(e){e.row.id&&this.needDelRels.push(e.row),this.refs=f.a.remove(this.refs,(function(t,l){return l!==e.$index}))}},{key:"addNewRef",value:function(){this.refs.push({id:"",stName:"",inRelation:"1",modelName:"",stDestName:"",stDestModelID:""})}},{key:"onChange",value:function(e){e?this.loadData():this.clearData()}},{key:"row",get:function(){return[{label:this.$t("名称"),prop:"stName",placeholder:this.$t("名称")},{label:this.$t("表名"),prop:"stTableName",placeholder:this.$t("表名")}]}},{key:"rules",get:function(){return{name:[{required:!0,message:this.$t("用户名不能为空"),trigger:"blur"}],pass:[{required:!0,message:this.$t("密码不能为空"),trigger:"blur"}]}}}]),l}(c["f"]);Object(u["a"])([Object(c["d"])({default:null})],m.prototype,"id",void 0),Object(u["a"])([Object(c["d"])({default:[]})],m.prototype,"models",void 0),Object(u["a"])([Object(c["b"])("pageLoad")],m.prototype,"pageLoad",null),Object(u["a"])([Object(c["g"])("id",{immediate:!0})],m.prototype,"onChange",null),m=Object(u["a"])([c["a"]],m);var b=m,p=b,h=(l("ceb9"),l("2877")),v=Object(h["a"])(p,a,o,!1,null,"538ae3cc",null);t["default"]=v.exports}}]);